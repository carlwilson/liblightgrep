<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Liblightgrep by strozfriedberg</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-dark.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Liblightgrep</h1>
        <p>Fast multipattern regular expression searching for digital forensics</p>
        <p class="view"><a href="https://github.com/strozfriedberg/liblightgrep">View the Project on GitHub <small>strozfriedberg/liblightgrep</small></a></p>
        <ul>
          <li><a href="https://github.com/strozfriedberg/liblightgrep/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/strozfriedberg/liblightgrep/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/strozfriedberg/liblightgrep">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>
<a id="liblightgrep" class="anchor" href="#liblightgrep" aria-hidden="true"><span class="octicon octicon-link"></span></a>liblightgrep</h1>

<p>Fast multipattern regular expression searching for digital forensics</p>

<h2>
<a id="about" class="anchor" href="#about" aria-hidden="true"><span class="octicon octicon-link"></span></a>About</h2>

<hr>

<p>Lightgrep is a regular expression search engine, designed specifically for digital forensics. Why another regexp engine?</p>

<p>Lightgrep:</p>

<ul>
<li>searches for many patterns simultaneously</li>
<li>searches binary data as a stream, not as discrete lines of text</li>
<li>searches for patterns in many different encodings; give it dirty data, lightgrep don't care</li>
<li>never, ever, ever, never, never looks at a byte twice or backs up in your input</li>
<li>implements a large number of standard regexp features</li>
<li>follows the same hit-reporting rules as <a href="http://www.pcre.org/">PCRE</a>
</li>
<li>degrades gracefully in performance as patterns increase in number and complexity</li>
</ul>

<p>Lightgrep is still pretty new and doesn't have all the regexp features you might be used to. But it has enough features to be more than a toy, and what is supported is well-tested.</p>

<p>liblightgrep is copyright (c) 2010-2015, <a href="http://www.strozfriedberg.com">Stroz Friedberg, LLC</a>. liblightgrep is available under version 3 of the GNU Public License. See <a href="COPYING">COPYING</a> for details.</p>

<h2>
<a id="technical-info" class="anchor" href="#technical-info" aria-hidden="true"><span class="octicon octicon-link"></span></a>Technical Info</h2>

<hr>

<p>Lightgrep is implemented in portable C++11 but exposes a concise C API. The core of the API is defined in <a href="./include/lightgrep/api.h">include/lightgrep/api.h</a>. You can see a small example program at <a href="./c_example/main.c">c_example/main.c</a>.</p>

<p>Lightgrep depends on a number of <a href="http://www.boost.org/">Boost</a> libraries and also on <a href="http://www.icu-project.org">ICU</a>. Currently you will need gcc 4.6+ or clang 3.1 to compile the libraries.</p>

<h2>
<a id="install" class="anchor" href="#install" aria-hidden="true"><span class="octicon octicon-link"></span></a>Install</h2>

<hr>

<p>See the <a href="https://github.com/strozfriedberg/liblightgrep/blob/master/BUILD.md">BUILD.md file</a> for installation instructions.</p>

<h2>
<a id="usage" class="anchor" href="#usage" aria-hidden="true"><span class="octicon octicon-link"></span></a>Usage</h2>

<h3>
<a id="c-api" class="anchor" href="#c-api" aria-hidden="true"><span class="octicon octicon-link"></span></a>C API</h3>

<p>
  Lightgrep is implemented in C++ but exposes a small C API which is considered the public interface.
</p>
<ul>./include/lightgrep/ contains the C API headers:
  <li><a href="https://github.com/strozfriedberg/liblightgrep/blob/master/include/lightgrep/api.h">aph.h</a>&mdash;the primary search API</li>
  <li><a href="https://github.com/strozfriedberg/liblightgrep/blob/master/include/lightgrep/search_hit.h">search_hit.h</a>&mdash;defines the SearchHit struct and the search hit function callback signature</li>
  <li><a href="https://github.com/strozfriedberg/liblightgrep/blob/master/include/lightgrep/util.h">util.h</a>&mdash;functions for reading context around hits and safely transcoding to UTF-8</li>
  <li><a href="https://github.com/strozfriedberg/liblightgrep/blob/master/include/lightgrep/encodings.h">encodings.h</a>&mdash;names, aliases, and integer codes for all encodings lightgrep supports</li>
  <li><a href="https://github.com/strozfriedberg/liblightgrep/blob/master/include/lightgrep/transforms.h">transforms.h</a>&mdash;character and byte transformations that lightgrep supports</li>
</ul>

<p>
  In general, one must first create a few opaque objects: </code>LG_HFSM, LG_HPATTERNMAP, LG_HPATTERN</code>.
  Given a UTF-8 string of the pattern, <code>lg_parse_pattern()</code> validates the syntax of the pattern and populates the 
  <code>LG_HPATTERN</code> with the abstract syntax tree representation of the pattern. This is then added to the finite state 
  machine and the pattern map with <code>lg_add_pattern()</code>. <code>lg_add_pattern()</code> takes a single encoding chain 
  string which is the encoding of the pattern that one wants to search for. The same pattern can be added multiple times with
  different encoding chains, ensuring that lightgrep matches on the pattern in differently encoded raw data.
</p>
<p>
  Once all of the patterns have been added to the finite state machine and the pattern map, then the finite state machine must be
  transformed into a form that's amenable for searching. This is done with <code>lg_create_program()</code>, which takes the
  <code>LG_HFSM</code> and returns a new <code>LG_HPROGRAM</code>. The program is an opaque representation of the logic necessary
  to match against all of the patterns in all of their respective encodings. <code>lg_create_program()</code> is similar in 
  concept to the traditional REGCOMP function and it should generally only be called once and then reused with different search
  streams; if not, you'll find that lightgrep is glacially slow.
</p>
<p>
  After the program has been created, one can free memory by calling <code>lg_destroy_fsm()</code>. In contrast, the pattern map
  should be retained. Next, create a search context object with <code>lg_create_context()</code>. Creating a context is not as 
  heavyweight as <code>lg_create_program()</code> but one should generally reuse a context rather than creating a new one. With a
  context, begin searching data with <code>lg_search()</code>, which takes a buffer of data, a logical offset to associate with
  the beginning of the buffer, a callback function for receiving hits, and a <code>void*</code> value of one's choice which will
  be passed through the to the callback when hits are discovered. <code>lg_search()</code> can be invoked repeatedly on separate
  buffers and it will treat them as a stream, automatically handling hits that cross boundaries. Lightgrep does not retain the 
  buffers and searching will not, with average pattern sets, allocate much memory. However, problematic patterns can cause great
  increases in memory usage; more on this later.
</p>
<p>
  Once a stream has been searched, it is <i>essential</i> to call <code>lg_closeout_search()</code>. This tells Lightgrep that 
  no more data will be received on the stream and if there are any buffered hits, they will be flushed to the callback. 
  <code>lg_reset_context()</code> should then be called to begin searching new streams. Once searching completes, call the 
  <code>destroy_</code> functions on the pattern map, the program, and the contexts.
</p>
<p>
  The pattern map is nothing more than a lookup table that can be indexed into by <code>SearchHit.KeywordIndex</code> and will 
  return a pointer to an <code>LH_PatternInfo</code> struct. This struct contains the pattern as its original UTF-8 string and a
  string representing the encoding chain <i>of the hit</i>. <code>LG_PatternInfo</code> also has a <code>void*</code> pointer
  which one can set to associate custom data. This can be used to funnel hits on different patterns to different handlers.
</p>
<p>
  Lightgrep is thread agnostic. It performs no locking itself and in general is not thread safe. However, all API calls are
  re-entrant. Additionally, once all patterns have been added, the program and pattern map are immutable. They can therefore be
  shared safely between different threads. A typical threading scenario would be to have a pool of threads to handle searching
  different streams, with each thread having its own <code>LG_HCONTEXT</code> and sharing the pattern map and program. It is not
  really possible to use multithreading to parallelize searching of a single stream.
</p>


<h3>
<a id="python-api" class="anchor" href="#python-api" aria-hidden="true"><span class="octicon octicon-link"></span></a>Python API</h3>
<p>Lightgrep can be used from within Python scripts by importing the <code>pylightgrep</code> module located in the main lightgrep
source tree. The Lightgrep Python bindings are designed to work in Python 2.7+ and 3.4+ 
in both 32-bit and 64-bit versions. The liblightgrep.dll and support DLL architectures must, however, 
match the Python architecture otherwise an error will be generated. The Python bindings use the <a href="https://docs.python.org/2/library/ctypes.html">ctypes</a> module to
import liblightgrep and call into it via the C API.</p>
<p>
  The Python API is <a href="python.html">documented in more depth here</a>.
</p>

<p>The list of supported encodings can be found at the 
<a href="http://demo.icu-project.org/icu-bin/convexp">ICU Project website</a>.</p>

<h2>
<a id="syntax" class="anchor" href="#syntax" aria-hidden="true"><span class="octicon octicon-link"></span></a>Syntax</h2>
The table below contains an overview of simple syntax supported by Lightgrep. For a more detailed look at the full syntax, 
download the <a href="resources/LightgrepSyntaxCheatSheet.pdf">Lightgrep Syntax Cheat Sheet</a>.
<table>
  <tr><th>Expression</th><th>Description</th></tr>
  <tr><td>\xhh</td><td>A single Unicode code point</td></tr>
  <tr><td>\zhh</td><td>A single hex byte, regardless of encoding</td></tr>
  <tr><td>\w</td><td>Match a "word" character [0-9A-Za-z_]</td></tr>
  <tr><td>\W</td><td>Match a non-"word" character [^0-9A-Za-z_]</td></tr>
  <tr><td>\s</td><td>Match a whitespace character [\t\n\f\r ]</td></tr>
  <tr><td>\S</td><td>Match a non-whitespace character [^\t\n\f\r ]</td></tr>
  <tr><td>\d</td><td>Match a decimal digit [0-9]</td></tr>
  <tr><td>\D</td><td>Match a non-digit character [^0-9]</td></tr>
  <tr><td>\.</td><td>Literal character (.)</td></tr>
  <tr><td>.</td><td>Any character</td></tr>
  <tr><td>*</td><td>Match 0 or more times</td></tr>
  <tr><td>+</td><td>Match 1 or more times</td></tr>
  <tr><td>?</td><td>Match 1 or 0 times</td></tr>
  <tr><td>{n}</td><td>Match exactly n times</td></tr>
  <tr><td>{n,}</td><td>Match at least n times</td></tr>
  <tr><td>{n,m}</td><td>Match at least n but not more than m times</td></tr>
  <tr><td>[a-z]</td><td>a through z</td></tr>
  <tr><td>[xyz]</td><td>Either x, y, or z</td></tr>
  <tr><td>[^xyz]</td><td>Not x, y, or z</td></tr>
  <tr><td>(ab)</td><td>Group ab together for ?, +, *, |</td></tr>
  <tr><td>a|b</td><td>Either a or b</td></tr>
  <tr><td colspan=2>------ Unicode Operations ------</td></tr>
  <tr><td>\x{hhhhhh}</td><td>A single Unicode code point</td></tr>
  <tr><td>\N{U+hhhhhh}</td><td>A single Unicode code point</td></tr>
  <tr><td>\N{name}</td><td>A single Unicode code point with the given name</td></tr>
  <tr><td>\p{property}</td><td>\p{Script=Cyrillic} matches any Cyrillic code point</td></tr>
  <tr><td>\P{property}</td><td>Equivalent to [^\p{property}]</td></tr>
</table>

<h2>
<a id="implementation" class="anchor" href="#implementation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Implementation</h2>

<h2>
<a id="performance" class="anchor" href="#performance" aria-hidden="true"><span class="octicon octicon-link"></span></a>Performance</h2>
      </section>
    </div>
    <footer>
      <p>Project maintained by <a href="https://github.com/strozfriedberg">strozfriedberg</a></p>
      <p>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></p>
    </footer>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
  </body>
</html>
